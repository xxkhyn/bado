# 🎓 就活面接対策：技術的詳細ガイド (bado)

このドキュメントは、**基本情報技術者 (FE)** レベルの知識を持つエンジニアが、このシステムが「具体的にどのファイルで何をしているか」を理解し、面接でスムーズに回答できるようになることを目的としています。

---

## 📂 1. インフラ・環境設定ファイル

システム全体の土台となるファイル群です。

### `Dockerfile`
*   **役割**: **「サーバーの設計図」**。
*   **解説**:
    *   このアプリが動くために必要な OS (Linux)、言語 (Python)、ライブラリなどを定義したファイルです。
    *   これを `docker build` コマンドで実行すると、アプリが動く「コンテナ」という仮想環境が作られます。
    *   **ポイント**: 「私のPCでは動くけど、本番環境では動かない」という問題を解決するために使用しています。

### `requirements.txt`
*   **役割**: **「必要な外部ライブラリのリスト」**。
*   **解説**:
    *   Python界の `cron` や `npm install` のためのリストです。
    *   `Django`, `gunicorn` (サーバーソフト), `qrcode` (QR生成用) など、アプリで使用している外部パッケージの名前とバージョンが記載されています。
    *   `pip install -r requirements.txt` と叩くことで、これらを一括インストールします。

### `manage.py`
*   **役割**: **「Djangoアプリの司令塔」**。
*   **解説**:
    *   Django独自のコマンドを実行するためのスクリプトです。
    *   サーバーの起動 (`runserver`)、データベースの更新 (`migrate`)、管理者ユーザーの作成 (`createsuperuser`) など、開発中のあらゆる操作はここを経由して行います。

---

## ⚙️ 2. バックエンド (Django Core)

「リクエストを受け取り、データベースを操作し、レスポンスを返す」サーバーの中枢部分です。

### `circle_app/settings.py`
*   **役割**: **「全体の設定ファイル」**。
*   **解説**:
    *   データベースへの接続先情報、使用するアプリの登録、セキュリティ設定（許可するホスト名など）が書かれています。
    *   **FE的視点**: 「環境変数 (`os.environ`)」を読み込む記述が多く見られます。これは、パスワードなどの機密情報をコードに直接書かず、サーバー環境から注入することでセキュリティを高めるためです。

### `circle_app/urls.py`
*   **役割**: **「メインの受付窓口 (ルーティング)」**。
*   **解説**:
    *   ユーザーがブラウザで `/calendar/` や `/admin/` にアクセスしたとき、そのURLを「どのプログラム（ビュー）」に渡すかを振り分けます。
    *   会社の「総合受付」のような場所で、ここから各部署（各アプリの `urls.py`）へ案内されます。

### `core/models.py`
*   **役割**: **「データベースの設計図 (スキーマ)」**。
*   **解説**:
    *   **Model (モデル)** はデータベースのテーブル定義そのものです。
    *   **`User`**: ユーザー情報。一般的なID/PASSに加え、`role` (役職) という項目を追加し、「一般メンバー」「運営」「管理者」を区別できるようにしています。
    *   **`Event`**: イベント情報。タイトル、日時などを管理します。ここに `checkin_token` という項目があり、QRコードチェックイン用の一意な文字列を保存します。
    *   **`EventAttendance` (中間テーブル)**: FEで習う「多対多」の関係を解決するためのテーブルです。「誰が(User)・どのイベントに(Event)・いつ(TimeStamp)」参加したかを記録します。

### `core/views.py`
*   **役割**: **「実際の処理を行うプログラム (業務ロジック)」**。
*   **解説**:
    *   このシステムの心臓部です。リクエスト内容に応じて以下のどちらかを返します。
    *   **HTMLを返す関数 (MVCのView)**:
        *   `calendar_view`: データベースからイベント一覧を取得し、`calendar.html` にデータを埋め込んでブラウザに返します（サーバーサイドレンダリング）。
    *   **JSONデータを返す関数 (Web API)**:
        *   `event_add` / `event_vote`: JavaScriptからの「イベント作りたい」「参加ボタン押した」というリクエストに対し、成功・失敗の結果だけをデータ(JSON)で返します。



---

## 🎨 3. フロントエンド (画面・UI)

ユーザーの目に触れる、ブラウザ上で動く部分です。

### `templates/base.html`
*   **役割**: **「全ページ共通の骨組み (レイアウト)」**。
*   **解説**:
    *   ヘッダー、フッター、ナビゲーションバーなど、どのページでも変わらない部分が書かれています。
    *   他のHTMLファイルは、このファイルを「継承 (`extends`)」して、中身のコンテンツ部分だけを記述する仕組みになっています。これにより、ヘッダーの修正が1箇所で済みます。

### `templates/core/calendar.html`
*   **役割**: **「カレンダー画面のHTML」**。
*   **解説**:
    *   Djangoから渡されたイベントデータを元に、カレンダーのマス目を描画します。
    *   基本的には静的なHTMLですが、クリックしたときに動くように、各日付のマス目に `data-date="2024-10-01"` のような「データ属性」を持たせているのがポイントです。

### `static/css/style.css`
*   **役割**: **「デザイン・装飾」**。
*   **解説**:
    *   色、フォント、余白などの見た目を定義します。
    *   **ポイント**: CSS変数 (`var(--brand-primary)`) を使ってテーマカラーを一括管理しています。これにより、「ダークモード対応」などを簡単に実装できるようにしています。

### `static/js/calendar.js`
*   **役割**: **「画面の動き制御 (クライアントサイドスクリプト)」**。
*   **解説**:
    *   ユーザーのマウス操作（クリック）を検知して動きます。
    *   **DOM操作**: 「カレンダーの日付をクリックしたら、入力フォーム（モーダル）を表示する」といった処理。
    *   **非同期通信 (Ajax/Fetch API)**: 「参加ボタン」を押したとき、画面全体を再読み込みすることなく、サーバー(`views.token_vote`)に「参加します！」と通信し、結果を受け取ってボタンの色だけを変えます。これが「サクサク動く」体験を作っています。

### `static/manifest.json`
*   **役割**: **「PWA (アプリ化) のための設定書」**。
*   **解説**:
    *   このWebサイトをスマホのホーム画面に追加したとき、「アプリアイコンは何にするか」「起動したときの画面の色はどうするか」「URLバーを表示するか」などの設定が書かれたJSONファイルです。
    *   これを置くことで、ブラウザで見るWebサイトが、まるでネイティブアプリのように振る舞います。

### `static/sw.js` (Service Worker)
*   **役割**: **「ブラウザの裏方さん (プロキシ)」**。
*   **解説**:
    *   Webページとは別のスレッドで裏で動くJavaScriptです。
    *   **キャッシュ機能**: 一度読み込んだ画像やCSSをブラウザ内に保存しておき、2回目以降は通信せずにそこから素早く表示させることで、表示速度を劇的に上げています。

---

## 🚀 4. パフォーマンスチューニング (改善事例)

動作が重くなる問題を解消するために、以下の最適化を行いました。「問題発見能力」と「解決力」のアピールに使えます。

### データベースのインデックス (`core/models.py`)
*   **変更点**: `Event` モデルの `start` (開始日時) に `db_index=True` を追加。
*   **理由**: 今まではカレンダー表示のたびに全イベントデータを日付順に並べ替えていましたが、インデックスを作ることで「辞書の索引」のように一瞬で該当データを取り出せるようにしました。計算量は O(N) から O(log N) に改善されています。

### N+1問題の解消 (`core/views.py`)
*   **変更点**: `views.events_json` で `Annotate` を使用。
*   **理由**: イベント一覧を表示する際、以前は「イベントのリストを取得(1回)」した後に「ループ処理で各イベントの参加人数を数える(N回)」という無駄なクエリが発生していました。これを `Event.objects.annotate(count=Count('attendances'))` と書くことで、SQLの `GROUP BY` を使って1回のクエリでまとめて取得するように改善しました。

### インフラ構成の見直し (未実施・今後の課題)
*   **課題**: 開発中、アプリ(日本)からデータベース(シンガポール)への物理的距離による遅延が発生。
*   **解決策**: 本番運用時はアプリもデータベースと同じリージョン（クラウド上）にデプロイすることで、通信距離をほぼゼロにし、劇的な高速化を実現します。「ローカル開発では重くても、本番構成では速くなる」というアーキテクチャの理解を示すポイントです。

### データベース接続の持続化 (`settings.py`)
*   **変更点**: `CONN_MAX_AGE` を `0` から `600` (10分) に変更。
*   **理由**: クラウドDB(Supabase)への接続は、通信のたびに「SSLハンドシェイク」という重い認証処理が発生します。これを「毎回切断(0)」から「10分間繋ぎっぱなし(600)」にすることで、2回目以降の通信オーバーヘッドをほぼゼロにしました。特にPaaS環境では劇的な速度改善が見込めます。

---

## 📝 面接で使える要約フレーズ

*   **「バックエンドは Django を使用しています。MTVモデル（MVCのようなもの）に従い、`models.py` でDB設計、`views.py` で業務処理、テンプレートで画面表示を行っています。」**
*   **「フロントエンドは、基本はサーバー側でHTMLを作るMPA構成ですが、カレンダー操作など動的な部分は `calendar.js` と Fetch API を使って非同期処理を行い、UXを高めています。」**
*   **「インフラは Docker で環境を統一し、PWA対応することでスマホからの利便性を向上させています。」**
