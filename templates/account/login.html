{% extends "base.html" %}
{% load i18n %}
{% load account socialaccount %}

{% block title %}ログイン{% endblock %}

{% block content %}
<div class="flex-center" style="min-height: 80vh; padding: 20px;">
    <div class="card" style="width: 100%; max-width: 420px; padding: 40px; border-top: 4px solid var(--brand-primary);">
        <h1
            style="text-align: center; margin-bottom: 32px; font-size: 1.75rem; font-weight: 800; letter-spacing: -0.03em;">
            ログイン</h1>

        {% get_providers as socialaccount_providers %}

        {% if socialaccount_providers %}
        <div class="socialaccount_ballot">
            <ul class="socialaccount_providers" style="list-style:none; padding:0; margin:0;">
                {% include "socialaccount/snippets/provider_list.html" with process="login" %}
            </ul>

            <div class="login-or"
                style="text-align:center; margin: 32px 0; position:relative; color:var(--text-muted); font-size:0.85rem;">
                <span
                    style="background:var(--bg-surface); padding:0 12px; position:relative; z-index:1; font-weight:600; letter-spacing:0.05em;">または</span>
                <div style="position:absolute; top:50%; left:0; right:0; height:1px; background:var(--border-default);">
                </div>
            </div>
        </div>

        {% include "socialaccount/snippets/login_extra.html" %}
        {% endif %}

        <form class="login" method="POST" action="{% url 'account_login' %}">
            {% csrf_token %}

            {% if form.errors %}
            <div
                style="background:rgba(239,68,68,0.1); border:1px solid var(--accent-danger); color:var(--accent-danger); padding:16px; border-radius:var(--radius-md); margin-bottom:24px; font-size:0.9rem; display:flex; flex-direction:column; gap:8px;">
                {% for field in form %}
                {% for error in field.errors %}
                <div style="display:flex; align-items:center; gap:8px;">
                    <span style="font-size:1.1em;">⚠️</span> {{ error }}
                </div>
                {% endfor %}
                {% endfor %}
                {% if form.non_field_errors %}
                {% for error in form.non_field_errors %}
                <div style="display:flex; align-items:center; gap:8px;">
                    <span style="font-size:1.1em;">⚠️</span> {{ error }}
                </div>
                {% endfor %}
                {% endif %}
            </div>
            {% endif %}

            <div class="field">
                <label for="{{ form.login.id_for_label }}">メールアドレス または ユーザー名</label>
                <input type="text" name="login" placeholder="example@email.com" autocomplete="username" required
                    id="{{ form.login.id_for_label }}">
            </div>

            <div class="field">
                <label for="{{ form.password.id_for_label }}">パスワード</label>
                <input type="password" name="password" placeholder="••••••••" autocomplete="current-password" required
                    id="{{ form.password.id_for_label }}">
            </div>

            {% if redirect_field_value %}
            <input type="hidden" name="{{ redirect_field_name }}" value="{{ redirect_field_value }}" />
            {% endif %}

            <button class="primaryAction btn btn-primary" type="submit"
                style="width:100%; margin-top:12px; padding: 14px;">ログイン</button>

            <div
                style="text-align:center; margin-top:24px; font-size:0.9rem; display: flex; flex-direction: column; gap: 12px;">
                <a class="button secondaryAction" href="{% url 'account_reset_password' %}"
                    style="color:var(--text-muted); text-decoration:underline; text-underline-offset:4px;">パスワードをお忘れですか？</a>
                <div style="color: var(--text-muted);">
                    アカウントをお持ちでない方は <a href="{% url 'account_signup' %}"
                        style="color: var(--brand-primary); font-weight: 600;">新規登録</a>
                </div>
            </div>
        </form>
    </div>
</div>
{% endblock %}