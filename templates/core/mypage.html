{% extends "base.html" %}
{% load custom_filters %}

{% block title %}マイページ{% endblock %}

{% block content %}
<div style="max-width: 800px; margin: 0 auto;">

    <!-- Profile Header -->
    <div class="profile-header">
        <div class="profile-avatar">
            {{ user.username|first|upper }}
        </div>
        <h1 style="font-size: 1.5rem; font-weight: 800; margin: 0;">{{ user.username }}</h1>
        <p style="color: var(--text-muted); font-size: 0.9rem; margin-top: 4px;">{{ user.email }}</p>
    </div>

    <!-- Stats Card -->
    <div class="stats-card">
        <div class="stats-bg-circle"></div>

        <h2
            style="font-size: 0.9rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin: 0 0 12px 0;">
            Total Activities</h2>
        <div style="display: flex; align-items: baseline; gap: 8px;">
            <span class="stats-count">{{ total_count }}</span>
            <span style="font-size: 1rem; color: var(--text-dim); font-weight: 600;">回参加</span>
        </div>

        <div style="margin-top: 16px; font-size: 0.85rem; color: var(--text-muted);">
            {% if total_count == 0 %}
            まだイベントに参加していません。カレンダーから参加してみましょう！
            {% elif total_count < 5 %} 素晴らしいスタートです！ {% elif total_count < 10 %} アクティブに活動していますね！ {% else %}
                コミュニティの柱です！ありがとうございます！ {% endif %} </div>
        </div>

        <!-- Upcoming Events -->
        <div style="margin-bottom: 40px;">
            <h3 class="section-title">
                <span style="font-size: 1.2rem;">🚀</span> 参加予定のイベント
            </h3>

            {% if upcoming_events %}
            <div style="display: grid; gap: 12px;">
                {% for event in upcoming_events %}
                <div class="event-card">
                    <div class="event-date">
                        <div style="font-size: 0.75rem; color: var(--brand-primary); font-weight: 700;">{{
                            event.start|date:"M" }}</div>
                        <div style="font-size: 1.2rem; font-weight: 800;">{{ event.start|date:"d" }}</div>
                    </div>
                    <div style="flex: 1;">
                        <div style="font-weight: 700; font-size: 1rem; margin-bottom: 4px;">{{ event.title }}</div>
                        <div style="font-size: 0.85rem; color: var(--text-muted);">{{ event|time_range }}</div>
                    </div>
                    <a href="{% url 'calendar' %}?y={{ event.start.year }}&m={{ event.start.month }}" class="btn"
                        style="font-size: 0.8rem; padding: 6px 12px;">詳細</a>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="empty-state">
                予定されているイベントはありません
            </div>
            {% endif %}
        </div>

        <!-- Past Events -->
        <div>
            <h3 class="section-title">
                <span style="font-size: 1.2rem;">📜</span> 過去の活動
            </h3>

            {% if past_events %}
            <div style="display: grid; gap: 12px;">
                {% for event in past_events %}
                <div class="event-card" style="opacity: 0.8;">
                    <div class="event-date" style="color: var(--text-muted);">
                        <div style="font-size: 0.75rem;">{{ event.start|date:"Y" }}</div>
                        <div style="font-size: 0.9rem; font-weight: 700;">{{ event.start|date:"m/d" }}</div>
                    </div>
                    <div style="flex: 1;">
                        <div style="font-weight: 600; font-size: 0.95rem; color: var(--text-dim);">{{ event.title }}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="empty-state">
                履歴はありません
            </div>
            {% endif %}
        </div>

    </div>
    {% endblock %}