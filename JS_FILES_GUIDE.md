# 📜 JavaScript 完全解説マニュアル

「どのファイルに何が書かれているか」を1ファイルずつ解説します。
面接で「フロントエンドの実装詳細」を聞かれた際のアンチョコとして使ってください。

---

## 1. `static/js/base.js`
**役割**: 全ページ共通の「基本動作」を管理するファイル。

| 機能 | 解説 |
| :--- | :--- |
| **PWA化 (Service Worker)** | `navigator.serviceWorker.register` で `sw.js` を読み込み、アプリ化の準備をします。 |
| **アバターメニュー** | 右上のアイコンを押した時のメニュー表示/非表示(トグル)と、外側クリックで閉じる処理。 |
| **スマホ用メニュー連携** | スマホ画面下の「マイページ」ボタンを押した時、PC版のメニューボタンを「押したことにする」連携処理。 |

---

## 2. `static/js/calendar.js`
**役割**: カレンダー画面 (`calendar.html`) のメインロジック。**一番コード量が多い重要ファイル**です。

### 主な処理ブロック
1.  **CSRF対策 (`getCookie`)**
    *   Djangoと通信する際、「私は怪しいハッカーではありません」という証明書(トークン)を取得する処理。
2.  **設定と要素の取得**
    *   HTMLに埋め込まれた `id="..."` を使って、ボタンやモーダル(ポップアップ)の部品を JavaScript で操作できるようにします。
3.  **日付オプションの生成**
    *   その月の日数（28日〜31日）を計算し、プルダウンメニューを作ります。
4.  **モーダル (ポップアップ) の制御**
    *   `openModal()`: 予定をクリックした時に、その予定の情報をフォームに入れて画面を開く。
    *   権限チェック (`canManage`) もここで行い、編集できない人は保存ボタンを隠します。
5.  **保存 (`saveBtn.onclick`) / 削除 (`delBtn.onclick`)**
    *   入力されたデータを検証し、Fetch API を使って Django のサーバー (`/api/events/...`) に送信します。
6.  **参加機能 (`loadAttendance`, `toggleAttendance`)**
    *   「参加する」ボタンを押した時に、サーバーに参加/不参加の変更を送り、ボタンの色と人数を即座に書き換えます。
7.  **QRコード表示**
    *   管理者のみ、そのイベント専用の「チェックイン用QRコード」を表示する機能。

---

## 3. `static/js/home_calendar.js`
**役割**: FullCalendar (ライブラリ) を使ったカレンダー表示用。
※ 現在の `calendar.html` (自作カレンダー) ではなく、トップページ等のカレンダー表示に使われている可能性があります。

| 機能 | 解説 |
| :--- | :--- |
| **FullCalendar初期化** | `new FullCalendar.Calendar` でカレンダーを描画。 |
| **イベント取得** | `/events-json/` からデータを取ってくる設定。 |
| **ドラッグ＆ドロップ** | `eventChange` で、予定をドラッグして日付変更した時の保存処理。 |

---

## 4. `static/sw.js` (Service Worker)
**役割**: アプリ化 (PWA) のための裏方さん。ブラウザの裏で動く特殊なスクリプト。

| 機能 | 解説 |
| :--- | :--- |
| **キャッシュ (Cache)** | `style.css` や `icon.png` などのファイルをスマホ内に保存し、2回目以降の表示を爆速にする。 |
| **オフライン対応** | 電波がない時でも、保存されたキャッシュを使って画面を表示させる処理 (`fetch` イベントの横取り)。 |

---

## 5. `static/manifest.json`
**役割**: アプリの「設定書」（JSではなくJSONデータ）。

*   アプリ名 (`bado`)
*   アイコン画像の場所
*   **`"display": "standalone"`**: これがあるおかげで、ブラウザのURLバーが消えてアプリっぽく表示されます。
