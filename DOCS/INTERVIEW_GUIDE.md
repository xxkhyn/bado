# 🎓 就活面接対策：技術的詳細ガイド (bado)

このドキュメントは、**基本情報技術者 (FE)** レベルの知識を持つエンジニアが、このシステムが「具体的にどのファイルで何をしているか」を理解し、面接でスムーズに回答できるようになることを目的としています。

---

## 📂 1. インフラ・環境設定ファイル

システム全体の土台となるファイル群です。

> [!IMPORTANT]
> **最初に読むもの**:
> 全体像を把握するための地図を作りました。まずは **[🗺️ アプリ完全構成図 (COMPLETE_FILE_MAP.md)](COMPLETE_FILE_MAP.md)** を見て、どのファイルがどこにあるかを確認してください。

### `Dockerfile`
*   **役割**: **「サーバーの設計図」**。
*   **解説**:
    *   このアプリが動くために必要な OS (Linux)、言語 (Python)、ライブラリなどを定義したファイルです。
    *   これを `docker build` コマンドで実行すると、アプリが動く「コンテナ」という仮想環境が作られます。
    *   **ポイント**: 「私のPCでは動くけど、本番環境では動かない」という問題を解決するために使用しています。

### `requirements.txt`
*   **役割**: **「必要な外部ライブラリのリスト」**。
*   **解説**:
    *   Python界の `cron` や `npm install` のためのリストです。
    *   `Django`, `gunicorn` (サーバーソフト), `qrcode` (QR生成用) など、アプリで使用している外部パッケージの名前とバージョンが記載されています。
    *   `pip install -r requirements.txt` と叩くことで、これらを一括インストールします。

### `manage.py`
*   **役割**: **「Djangoアプリの司令塔」**。
*   詳細は [🐍 Pythonファイル詳細解説](PYTHON_FILES_GUIDE.md) を参照。

---

## ⚙️ 2. バックエンド (Django Core)

Pythonファイル (`models.py`, `views.py` 等) の詳細は、以下の別冊ガイドにまとめました。

👉 **[🐍 Pythonファイル詳細解説 (PYTHON_FILES_GUIDE.md)](PYTHON_FILES_GUIDE.md)**

---




### 「参加」と「出席」の区別ロジック
*   **仕様**: 「参加ボタンを押した（予約）」と「当日来た（出席）」を明確に区別しています。
*   **実装**:
    *   `EventAttendance` テーブルに `checked_in_at` (出席時刻) カラムを追加しました。
    *   **予約**: 参加ボタンを押すとレコードが作成されます (`checked_in_at` は空)。
    *   **出席**: QRコードを読み込むと、既存のレコードの `checked_in_at` に現在時刻が記録されます。
    *   これにより、「予約したけど来なかった人」や「予約なしで当日来た人」の集計が可能になっています。



---

## 🎨 4. フロントエンド (画面・UI)

ユーザーの目に触れる、ブラウザ上で動く部分です。

### `templates/base.html`
*   **役割**: **「全ページ共通の骨組み (レイアウト)」**。
*   **解説**:
    *   ヘッダー、フッター、ナビゲーションバーなど、どのページでも変わらない部分が書かれています。
    *   他のHTMLファイルは、このファイルを「継承 (`extends`)」して、中身のコンテンツ部分だけを記述する仕組みになっています。これにより、ヘッダーの修正が1箇所で済みます。

### `templates/core/calendar.html`
*   **役割**: **「カレンダー画面のHTML」**。
*   **解説**:
    *   Djangoから渡されたイベントデータを元に、カレンダーのマス目を描画します。
    *   基本的には静的なHTMLですが、クリックしたときに動くように、各日付のマス目に `data-date="2024-10-01"` のような「データ属性」を持たせているのがポイントです。

### `static/css/style.css`
*   **役割**: **「デザイン・装飾」**。
*   **解説**:
    *   色、フォント、余白などの見た目を定義します。
    *   **ポイント**: CSS変数 (`var(--brand-primary)`) を使ってテーマカラーを一括管理しています。これにより、「ダークモード対応」などを簡単に実装できるようにしています。

### `static/js/calendar.js`
*   **役割**: **「画面の動き制御 (クライアントサイドスクリプト)」**。
*   **解説**:
    *   ユーザーのマウス操作（クリック）を検知して動きます。
    *   **DOM操作**: 「カレンダーの日付をクリックしたら、入力フォーム（モーダル）を表示する」といった処理。
    *   **非同期通信 (Ajax/Fetch API)**: 「参加ボタン」を押したとき、画面全体を再読み込みすることなく、サーバー(`views.token_vote`)に「参加します！」と通信し、結果を受け取ってボタンの色だけを変えます。これが「サクサク動く」体験を作っています。

### `static/manifest.json`
*   **役割**: **「PWA (アプリ化) のための設定書」**。
*   **解説**:
    *   このWebサイトをスマホのホーム画面に追加したとき、「アプリアイコンは何にするか」「起動したときの画面の色はどうするか」「URLバーを表示するか」などの設定が書かれたJSONファイルです。
    *   これを置くことで、ブラウザで見るWebサイトが、まるでネイティブアプリのように振る舞います。

### `static/sw.js` (Service Worker)
*   **役割**: **「ブラウザの裏方さん (プロキシ)」**。
*   **解説**:
    *   Webページとは別のスレッドで裏で動くJavaScriptです。
    *   **キャッシュ機能**: 一度読み込んだ画像やCSSをブラウザ内に保存しておき、2回目以降は通信せずにそこから素早く表示させることで、表示速度を劇的に上げています。

---

## 🚀 5. パフォーマンスチューニング (改善事例)

動作が重くなる問題を解消するために、以下の最適化を行いました。「問題発見能力」と「解決力」のアピールに使えます。

### データベースのインデックス (`core/models.py`)
*   **変更点**: `Event` モデルの `start` (開始日時) に `db_index=True` を追加。
*   **理由**: 今まではカレンダー表示のたびに全イベントデータを日付順に並べ替えていましたが、インデックスを作ることで「辞書の索引」のように一瞬で該当データを取り出せるようにしました。計算量は O(N) から O(log N) に改善されています。

### N+1問題の解消 (`core/views.py`)
*   **変更点**: `views.events_json` で `Annotate` を使用。
*   **理由**: イベント一覧を表示する際、以前は「イベントのリストを取得(1回)」した後に「ループ処理で各イベントの参加人数を数える(N回)」という無駄なクエリが発生していました。これを `Event.objects.annotate(count=Count('attendances'))` と書くことで、SQLの `GROUP BY` を使って1回のクエリでまとめて取得するように改善しました。

### インフラ構成の見直し (未実施・今後の課題)
*   **課題**: 開発中、アプリ(日本)からデータベース(シンガポール)への物理的距離による遅延が発生。
*   **解決策**: 本番運用時はアプリもデータベースと同じリージョン（クラウド上）にデプロイすることで、通信距離をほぼゼロにし、劇的な高速化を実現します。「ローカル開発では重くても、本番構成では速くなる」というアーキテクチャの理解を示すポイントです。

### データベース接続の持続化 (`settings.py`)
*   **変更点**: `CONN_MAX_AGE` を `0` から `600` (10分) に変更。
*   **理由**: クラウドDB(Supabase)への接続は、通信のたびに「SSLハンドシェイク」という重い認証処理が発生します。これを「毎回切断(0)」から「10分間繋ぎっぱなし(600)」にすることで、2回目以降の通信オーバーヘッドをほぼゼロにしました。特にPaaS環境では劇的な速度改善が見込めます。

---

## 📝 面接で使える要約フレーズ

*   **「バックエンドは Django を使用しています。MTVモデル（MVCのようなもの）に従い、`models.py` でDB設計、`views.py` で業務処理、テンプレートで画面表示を行っています。」**
*   **「フロントエンドは、基本はサーバー側でHTMLを作るMPA構成ですが、カレンダー操作など動的な部分は `calendar.js` と Fetch API を使って非同期処理を行い、UXを高めています。」**
*   **「インフラは Docker で環境を統一し、PWA対応することでスマホからの利便性を向上させています。」**

---

## 🙋‍♂️ 6. よく聞かれる質問 (Q&A カンペ)

**「これだけは暗記！」** という最重要ポイントです。

### Q1. 「DB設計(モデルスキーマ)はどうなっていますか？」
*   **回答**:
    *   「主に **ユーザー(User)**、**イベント(Event)**、**参加記録(EventAttendance)** の3つのテーブルで構成されています」
    *   「**User**テーブルには、一般・運営・管理者を分ける `role` というカラムを持たせています」
    *   「**Event**テーブルは、カレンダーでの検索を速くするために、日付(`start`)にインデックスを貼っています」
    *   「**EventAttendance**テーブルは、『予約』と『QR出席』を区別するために `checked_in_at` という時間を記録するカラムを持たせています」

### Q2. 「このアプリのアーキテクチャ(構成)は？」
*   **回答**:
    *   「Pythonの **Django** フレームワークを使った **MTVモデル** です」
    *   「基本はサーバー側でHTMLを作る(SSR)構成ですが、カレンダーなどの動的な部分は **JavaScript (Fetch API)** を使って、画面遷移なしで動くように工夫しました」
    *   「インフラは **Docker** で開発環境を作り、本番は **Render** と **Supabase** にデプロイしています」


### Q3. 「工夫した点・難しかった点は？」
*   **回答**:
    *   「スマホ対応(PWA)と、パフォーマンス高速化です」
    *   「特に、DB接続が遅い問題がありましたが、コネクションプーリングの設定で解決しました（詳細は下述）」

---

## ☠️ 7. 技術的失敗談 (面接ネタ)

「失敗から何を学んだか」はエンジニア面接で**一番盛り上がる話題**です。実体験として話してください。

### ① 「ローカル開発がとにかく重かった事件」
*   **現象**: WindowsでDockerを使って開発していたが、ファイルの変更反映が遅すぎて開発が進まなかった。
*   **原因**: WindowsのファイルシステムとLinux(Docker)の間での同期(I/O)がボトルネックになっていた。
*   **対策**: `WSL2` を導入して、Linuxファイルシステム上で開発するようにしたら爆速になった。
*   **学び**: 「開発環境のOSごとの特性を知ることの重要性を学びました」

### ② 「本番環境だけ激重になった事件」
*   **現象**: ローカルではサクサク動くのに、本番(Render)に上げたら1ページ開くのに3秒かかった。
*   **原因**:
    1.  Webサーバー(Render/米国)とDB(Supabase/シンガポール)の距離が遠すぎた。
    2.  しかも `conn_max_age=0` (デフォルト) だったので、1回通信するたびに「TCP接続→SSL認証→切断」を繰り返していた。
*   **対策**: `settings.py` で `CONN_MAX_AGE = 600` (10分間維持) に設定した。
*   **結果**: 2回目以降の通信が**0.1秒以下**になり、体感速度が劇的に向上した。
*   **学び**: 「クラウドインフラでは、サーバーの物理配置とネットワークオーバーヘッドを考慮すべきだと痛感しました」

### ③ 「N+1問題でカレンダーが表示されなくなった事件」
*   **現象**: イベントが増えてきたら、カレンダーの表示が目に見えて遅くなった。
*   **原因**: 「イベント一覧を取得(1回)」した後に、「forループの中で参加人数を数える(SQL発行 × イベント数)」という処理を書いていた。
*   **対策**: Djangoの `annotate` を使って、最初の1回のSQLで「参加人数」もまとめて計算させるようにした。
*   **学び**: 「ORMは便利ですが、裏でどんなSQLが走っているか意識しないとすぐに性能劣化することを学びました」

---

## 🎨 8. フロントエンドの技術的工夫 (アピールポイント)

バックエンドだけでなく、**「ユーザー体験(UX)」** にもこだわった点です。

### ① ハイブリッド・アーキテクチャ (SSR + SPA)
*   **工夫**: 基本はDjangoでHTML生成(SSR)して **「初期表示の速さとSEO」** を確保しつつ、カレンダー操作などのインタラクティブな部分だけFetch API(JS)を使って **「ページ遷移なしで動く(SPA的挙動)」** ようにしました。
*   **効果**: 「サクサク動くのに、検索エンジンにも強い」という、両方のいいとこ取りを実現しています。

### ② PWA (Progressive Web App) 対応
*   **工夫**: `manifest.json` と Service Worker (`sw.js`) を実装しました。
*   **効果**:
    *   スマホのホーム画面にアイコンを追加して、ネイティブアプリのように使えます。
    *   Service Workerで画像やCSSをキャッシュし、2回目以降の表示を高速化しています。

### ③ モダンCSS設計 (脱Bootstrap)
*   **工夫**: 安易にBootstrapなどの重いフレームワークを使わず、**CSS変数 (`var(--brand-primary)`)** と Flexbox/Grid で自作しました。
*   **効果**:
    *   余計なコードがないのでロードが軽量。
    *   「ダークモード対応」や「テーマカラー変更」が、変数を1つ変えるだけで全ページに反映される保守性の高さを実現しました。

---

## 🛡️ 9. ロジックの堅牢化 (Safety Measures)

ユーザーの不正操作や矛盾した状態を防ぐための制限ロジックです。

### ① 過去のイベントへの投票制限
*   **仕様**: イベント終了時刻を過ぎたイベントの参加ボタンは押せない（エラーになる）ようにしました。
*   **理由**: 「終わったイベントに後から参加表明する」という矛盾を防ぐためです。
*   **実装**:
    *   Backend (`views.py`): `if timezone.now() > event.end: return 403`
    *   Frontend (`calendar.js`): 403エラーを受け取ったら「イベント終了後は変更できません」とアラートを表示。




